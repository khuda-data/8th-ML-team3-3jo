import pandas as pd

df_202201_suwon=pd.read_csv('C:/portfolio/khuda_toyproject/데이터셋/카드데이터/tbsh_gyeonggi_day_202201_수원시.csv')
df_202202_suwon=pd.read_csv('C:/portfolio/khuda_toyproject/데이터셋/카드데이터/tbsh_gyeonggi_day_202202_수원시.csv')
df_202203_suwon=pd.read_csv('C:/portfolio/khuda_toyproject/데이터셋/카드데이터/tbsh_gyeonggi_day_202203_수원시.csv')
df_202204_suwon=pd.read_csv('C:/portfolio/khuda_toyproject/데이터셋/카드데이터/tbsh_gyeonggi_day_202204_수원시.csv')
df_202205_suwon=pd.read_csv('C:/portfolio/khuda_toyproject/데이터셋/카드데이터/tbsh_gyeonggi_day_202205_수원시.csv')
df_202206_suwon=pd.read_csv('C:/portfolio/khuda_toyproject/데이터셋/카드데이터/tbsh_gyeonggi_day_202206_수원시.csv')
df_202207_suwon=pd.read_csv('C:/portfolio/khuda_toyproject/데이터셋/카드데이터/tbsh_gyeonggi_day_202207_수원시.csv')
df_202208_suwon=pd.read_csv('C:/portfolio/khuda_toyproject/데이터셋/카드데이터/tbsh_gyeonggi_day_202208_수원시.csv')
df_202209_suwon=pd.read_csv('C:/portfolio/khuda_toyproject/데이터셋/카드데이터/tbsh_gyeonggi_day_202209_수원시.csv')
df_202210_suwon=pd.read_csv('C:/portfolio/khuda_toyproject/데이터셋/카드데이터/tbsh_gyeonggi_day_202210_수원시.csv')
df_202211_suwon=pd.read_csv('C:/portfolio/khuda_toyproject/데이터셋/카드데이터/tbsh_gyeonggi_day_202211_수원시.csv')
df_202212_suwon=pd.read_csv('C:/portfolio/khuda_toyproject/데이터셋/카드데이터/tbsh_gyeonggi_day_202212_수원시.csv')

df_202301_suwon=pd.read_csv('C:/portfolio/khuda_toyproject/데이터셋/카드데이터/tbsh_gyeonggi_day_202301_수원시.csv')
df_202302_suwon=pd.read_csv('C:/portfolio/khuda_toyproject/데이터셋/카드데이터/tbsh_gyeonggi_day_202302_수원시.csv')
df_202303_suwon=pd.read_csv('C:/portfolio/khuda_toyproject/데이터셋/카드데이터/tbsh_gyeonggi_day_202303_수원시.csv')
df_202304_suwon=pd.read_csv('C:/portfolio/khuda_toyproject/데이터셋/카드데이터/tbsh_gyeonggi_day_202304_수원시.csv')
df_202305_suwon=pd.read_csv('C:/portfolio/khuda_toyproject/데이터셋/카드데이터/tbsh_gyeonggi_day_202305_수원시.csv')
df_202306_suwon=pd.read_csv('C:/portfolio/khuda_toyproject/데이터셋/카드데이터/tbsh_gyeonggi_day_202306_수원시.csv')
df_202307_suwon=pd.read_csv('C:/portfolio/khuda_toyproject/데이터셋/카드데이터/tbsh_gyeonggi_day_202307_수원시.csv')
df_202308_suwon=pd.read_csv('C:/portfolio/khuda_toyproject/데이터셋/카드데이터/tbsh_gyeonggi_day_202308_수원시.csv')
df_202309_suwon=pd.read_csv('C:/portfolio/khuda_toyproject/데이터셋/카드데이터/tbsh_gyeonggi_day_202309_수원시.csv')
df_202310_suwon=pd.read_csv('C:/portfolio/khuda_toyproject/데이터셋/카드데이터/tbsh_gyeonggi_day_202310_수원시.csv')
df_202311_suwon=pd.read_csv('C:/portfolio/khuda_toyproject/데이터셋/카드데이터/tbsh_gyeonggi_day_202311_수원시.csv')
df_202312_suwon=pd.read_csv('C:/portfolio/khuda_toyproject/데이터셋/카드데이터/tbsh_gyeonggi_day_202312_수원시.csv')

df_202401_suwon=pd.read_csv('C:/portfolio/khuda_toyproject/데이터셋/카드데이터/tbsh_gyeonggi_day_202401_수원시.csv')
df_202402_suwon=pd.read_csv('C:/portfolio/khuda_toyproject/데이터셋/카드데이터/tbsh_gyeonggi_day_202402_수원시.csv')
df_202403_suwon=pd.read_csv('C:/portfolio/khuda_toyproject/데이터셋/카드데이터/tbsh_gyeonggi_day_202403_수원시.csv')
df_202404_suwon=pd.read_csv('C:/portfolio/khuda_toyproject/데이터셋/카드데이터/tbsh_gyeonggi_day_202404_수원시.csv')
df_202405_suwon=pd.read_csv('C:/portfolio/khuda_toyproject/데이터셋/카드데이터/tbsh_gyeonggi_day_수원시_202405.csv')
df_202406_suwon=pd.read_csv('C:/portfolio/khuda_toyproject/데이터셋/카드데이터/tbsh_gyeonggi_day_수원시_202406.csv')
df_202407_suwon=pd.read_csv('C:/portfolio/khuda_toyproject/데이터셋/카드데이터/tbsh_gyeonggi_day_수원시_202407.csv')
df_202408_suwon=pd.read_csv('C:/portfolio/khuda_toyproject/데이터셋/카드데이터/tbsh_gyeonggi_day_수원시_202408.csv')
df_202409_suwon=pd.read_csv('C:/portfolio/khuda_toyproject/데이터셋/카드데이터/tbsh_gyeonggi_day_수원시_202409.csv')
df_202410_suwon=pd.read_csv('C:/portfolio/khuda_toyproject/데이터셋/카드데이터/tbsh_gyeonggi_day_수원시_202410.csv')
df_202411_suwon=pd.read_csv('C:/portfolio/khuda_toyproject/데이터셋/카드데이터/tbsh_gyeonggi_day_수원시_202411.csv')
df_202412_suwon=pd.read_csv('C:/portfolio/khuda_toyproject/데이터셋/카드데이터/tbsh_gyeonggi_day_수원시_202412.csv',encoding='cp949')

##202201
df_202201_suwon = df_202201_suwon[df_202201_suwon['admi_cty_no'] == 41117585]

df_202201_suwon.groupby('card_tpbuz_nm_1')['amt'].sum().reset_index()

df_202201_suwon=df_202201_suwon.groupby(['card_tpbuz_nm_1', 'card_tpbuz_nm_2'])['amt'].sum().reset_index()
df_202201_suwon=df_202201_suwon.rename(columns={'amt': 'amt_202201'})
df_202201_suwon

##202202
df_202202_suwon=df_202202_suwon[df_202202_suwon['admi_cty_no'] == 41117585]
df_202202_suwon=df_202202_suwon.groupby(['card_tpbuz_nm_1', 'card_tpbuz_nm_2'])['amt'].sum().reset_index()
df_202202_suwon=df_202202_suwon.rename(columns={'amt': 'amt_202202'})
df_202202_suwon

def preprocess_monthly(df, month):
    """
    카드데이터에서 특정 admn_cty_no 필터 → 업종별 매출 합계 → 컬럼명 변경
    df : 원본 데이터프레임
    month : 문자열, 예) '202201'
    admi_no : 필터링할 admi_cty_no (기본값=41117585)
    """
    df = df[df['admi_cty_no'] == 41117585]
    df = df.groupby(['card_tpbuz_nm_1', 'card_tpbuz_nm_2'])['amt'].sum().reset_index()
    df = df.rename(columns={'amt': f'amt_{month}'})
    return df
df_202201_suwon=preprocess_monthly(df_202201_suwon,'202201')
df_202202_suwon=preprocess_monthly(df_202202_suwon,'202202')
df_202203_suwon=preprocess_monthly(df_202203_suwon,'202203')
df_202204_suwon=preprocess_monthly(df_202204_suwon,'202204')
df_202205_suwon=preprocess_monthly(df_202205_suwon,'202205')
df_202206_suwon=preprocess_monthly(df_202206_suwon,'202206')
df_202207_suwon=preprocess_monthly(df_202207_suwon,'202207')
df_202208_suwon=preprocess_monthly(df_202208_suwon,'202208')
df_202209_suwon=preprocess_monthly(df_202209_suwon,'202209')
df_202210_suwon=preprocess_monthly(df_202210_suwon,'202210')
df_202211_suwon=preprocess_monthly(df_202211_suwon,'202211')
df_202212_suwon=preprocess_monthly(df_202212_suwon,'202212')

df_202301_suwon=preprocess_monthly(df_202301_suwon,'202301')
df_202302_suwon=preprocess_monthly(df_202302_suwon,'202302')
df_202303_suwon=preprocess_monthly(df_202303_suwon,'202303')
df_202304_suwon=preprocess_monthly(df_202304_suwon,'202304')
df_202305_suwon=preprocess_monthly(df_202305_suwon,'202305')
df_202306_suwon=preprocess_monthly(df_202306_suwon,'202306')
df_202307_suwon=preprocess_monthly(df_202307_suwon,'202307')
df_202308_suwon=preprocess_monthly(df_202308_suwon,'202308')
df_202309_suwon=preprocess_monthly(df_202309_suwon,'202309')
df_202310_suwon=preprocess_monthly(df_202310_suwon,'202310')
df_202311_suwon=preprocess_monthly(df_202311_suwon,'202311')
df_202312_suwon=preprocess_monthly(df_202312_suwon,'202312')

df_202401_suwon=preprocess_monthly(df_202401_suwon,'202401')
df_202402_suwon=preprocess_monthly(df_202402_suwon,'202402')
df_202403_suwon=preprocess_monthly(df_202403_suwon,'202403')
df_202404_suwon=preprocess_monthly(df_202404_suwon,'202404')
df_202405_suwon=preprocess_monthly(df_202405_suwon,'202405')
df_202406_suwon=preprocess_monthly(df_202406_suwon,'202406')
df_202407_suwon=preprocess_monthly(df_202407_suwon,'202407')
df_202408_suwon=preprocess_monthly(df_202408_suwon,'202408')
df_202409_suwon=preprocess_monthly(df_202409_suwon,'202409')
df_202410_suwon=preprocess_monthly(df_202410_suwon,'202410')
df_202411_suwon=preprocess_monthly(df_202411_suwon,'202411')
df_202412_suwon=preprocess_monthly(df_202412_suwon,'202412')

pd.set_option('display.float_format', '{:.2f}'.format)
df_merge_khu = (
    df_202201_suwon
    .merge(df_202202_suwon, on=['card_tpbuz_nm_1','card_tpbuz_nm_2'], how='outer')
    .merge(df_202203_suwon, on=['card_tpbuz_nm_1','card_tpbuz_nm_2'], how='outer')
    .merge(df_202204_suwon, on=['card_tpbuz_nm_1','card_tpbuz_nm_2'], how='outer')
    .merge(df_202205_suwon, on=['card_tpbuz_nm_1','card_tpbuz_nm_2'], how='outer')
    .merge(df_202206_suwon, on=['card_tpbuz_nm_1','card_tpbuz_nm_2'], how='outer')
    .merge(df_202207_suwon, on=['card_tpbuz_nm_1','card_tpbuz_nm_2'], how='outer')
    .merge(df_202208_suwon, on=['card_tpbuz_nm_1','card_tpbuz_nm_2'], how='outer')
    .merge(df_202209_suwon, on=['card_tpbuz_nm_1','card_tpbuz_nm_2'], how='outer')
    .merge(df_202210_suwon, on=['card_tpbuz_nm_1','card_tpbuz_nm_2'], how='outer')
    .merge(df_202211_suwon, on=['card_tpbuz_nm_1','card_tpbuz_nm_2'], how='outer')
    .merge(df_202212_suwon, on=['card_tpbuz_nm_1','card_tpbuz_nm_2'], how='outer')
    .merge(df_202301_suwon, on=['card_tpbuz_nm_1','card_tpbuz_nm_2'], how='outer')
    .merge(df_202302_suwon, on=['card_tpbuz_nm_1','card_tpbuz_nm_2'], how='outer')
    .merge(df_202303_suwon, on=['card_tpbuz_nm_1','card_tpbuz_nm_2'], how='outer')
    .merge(df_202304_suwon, on=['card_tpbuz_nm_1','card_tpbuz_nm_2'], how='outer')
    .merge(df_202305_suwon, on=['card_tpbuz_nm_1','card_tpbuz_nm_2'], how='outer')
    .merge(df_202306_suwon, on=['card_tpbuz_nm_1','card_tpbuz_nm_2'], how='outer')
    .merge(df_202307_suwon, on=['card_tpbuz_nm_1','card_tpbuz_nm_2'], how='outer')
    .merge(df_202308_suwon, on=['card_tpbuz_nm_1','card_tpbuz_nm_2'], how='outer')
    .merge(df_202309_suwon, on=['card_tpbuz_nm_1','card_tpbuz_nm_2'], how='outer')
    .merge(df_202310_suwon, on=['card_tpbuz_nm_1','card_tpbuz_nm_2'], how='outer')
    .merge(df_202311_suwon, on=['card_tpbuz_nm_1','card_tpbuz_nm_2'], how='outer')
    .merge(df_202312_suwon, on=['card_tpbuz_nm_1','card_tpbuz_nm_2'], how='outer')
    .merge(df_202401_suwon, on=['card_tpbuz_nm_1','card_tpbuz_nm_2'], how='outer')
    .merge(df_202402_suwon, on=['card_tpbuz_nm_1','card_tpbuz_nm_2'], how='outer')
    .merge(df_202403_suwon, on=['card_tpbuz_nm_1','card_tpbuz_nm_2'], how='outer')
    .merge(df_202404_suwon, on=['card_tpbuz_nm_1','card_tpbuz_nm_2'], how='outer')
    .merge(df_202405_suwon, on=['card_tpbuz_nm_1','card_tpbuz_nm_2'], how='outer')
    .merge(df_202406_suwon, on=['card_tpbuz_nm_1','card_tpbuz_nm_2'], how='outer')
    .merge(df_202407_suwon, on=['card_tpbuz_nm_1','card_tpbuz_nm_2'], how='outer')
    .merge(df_202408_suwon, on=['card_tpbuz_nm_1','card_tpbuz_nm_2'], how='outer')
    .merge(df_202409_suwon, on=['card_tpbuz_nm_1','card_tpbuz_nm_2'], how='outer')
    .merge(df_202410_suwon, on=['card_tpbuz_nm_1','card_tpbuz_nm_2'], how='outer')
    .merge(df_202411_suwon, on=['card_tpbuz_nm_1','card_tpbuz_nm_2'], how='outer')
    .merge(df_202412_suwon, on=['card_tpbuz_nm_1','card_tpbuz_nm_2'], how='outer')
    
)
df_merge_khu.to_csv('C:/portfolio/khuda_toyproject/데이터셋/카드데이터/merge_khu.csv')
df_merge_khu

####용인
df_202201_yongin=pd.read_csv('C:/portfolio/khuda_toyproject/데이터셋/카드데이터/tbsh_gyeonggi_day_202201_용인시.csv')
df_202202_yongin=pd.read_csv('C:/portfolio/khuda_toyproject/데이터셋/카드데이터/tbsh_gyeonggi_day_202202_용인시.csv')
df_202203_yongin=pd.read_csv('C:/portfolio/khuda_toyproject/데이터셋/카드데이터/tbsh_gyeonggi_day_202203_용인시.csv')
df_202204_yongin=pd.read_csv('C:/portfolio/khuda_toyproject/데이터셋/카드데이터/tbsh_gyeonggi_day_202204_용인시.csv')
df_202205_yongin=pd.read_csv('C:/portfolio/khuda_toyproject/데이터셋/카드데이터/tbsh_gyeonggi_day_202205_용인시.csv')
df_202206_yongin=pd.read_csv('C:/portfolio/khuda_toyproject/데이터셋/카드데이터/tbsh_gyeonggi_day_202206_용인시.csv')
df_202207_yongin=pd.read_csv('C:/portfolio/khuda_toyproject/데이터셋/카드데이터/tbsh_gyeonggi_day_202207_용인시.csv')
df_202208_yongin=pd.read_csv('C:/portfolio/khuda_toyproject/데이터셋/카드데이터/tbsh_gyeonggi_day_202208_용인시.csv')
df_202209_yongin=pd.read_csv('C:/portfolio/khuda_toyproject/데이터셋/카드데이터/tbsh_gyeonggi_day_202209_용인시.csv')
df_202210_yongin=pd.read_csv('C:/portfolio/khuda_toyproject/데이터셋/카드데이터/tbsh_gyeonggi_day_202210_용인시.csv')
df_202211_yongin=pd.read_csv('C:/portfolio/khuda_toyproject/데이터셋/카드데이터/tbsh_gyeonggi_day_202211_용인시.csv')
df_202212_yongin=pd.read_csv('C:/portfolio/khuda_toyproject/데이터셋/카드데이터/tbsh_gyeonggi_day_202212_용인시.csv')

df_202301_yongin=pd.read_csv('C:/portfolio/khuda_toyproject/데이터셋/카드데이터/tbsh_gyeonggi_day_202301_용인시.csv')
df_202302_yongin=pd.read_csv('C:/portfolio/khuda_toyproject/데이터셋/카드데이터/tbsh_gyeonggi_day_202302_용인시.csv')
df_202303_yongin=pd.read_csv('C:/portfolio/khuda_toyproject/데이터셋/카드데이터/tbsh_gyeonggi_day_202303_용인시.csv')
df_202304_yongin=pd.read_csv('C:/portfolio/khuda_toyproject/데이터셋/카드데이터/tbsh_gyeonggi_day_202304_용인시.csv')
df_202305_yongin=pd.read_csv('C:/portfolio/khuda_toyproject/데이터셋/카드데이터/tbsh_gyeonggi_day_202305_용인시.csv')
df_202306_yongin=pd.read_csv('C:/portfolio/khuda_toyproject/데이터셋/카드데이터/tbsh_gyeonggi_day_202306_용인시.csv')
df_202307_yongin=pd.read_csv('C:/portfolio/khuda_toyproject/데이터셋/카드데이터/tbsh_gyeonggi_day_202307_용인시.csv')
df_202308_yongin=pd.read_csv('C:/portfolio/khuda_toyproject/데이터셋/카드데이터/tbsh_gyeonggi_day_202308_용인시.csv')
df_202309_yongin=pd.read_csv('C:/portfolio/khuda_toyproject/데이터셋/카드데이터/tbsh_gyeonggi_day_202309_용인시.csv')
df_202310_yongin=pd.read_csv('C:/portfolio/khuda_toyproject/데이터셋/카드데이터/tbsh_gyeonggi_day_202310_용인시.csv')
df_202311_yongin=pd.read_csv('C:/portfolio/khuda_toyproject/데이터셋/카드데이터/tbsh_gyeonggi_day_202311_용인시.csv')
df_202312_yongin=pd.read_csv('C:/portfolio/khuda_toyproject/데이터셋/카드데이터/tbsh_gyeonggi_day_202312_용인시.csv')

df_202401_yongin=pd.read_csv('C:/portfolio/khuda_toyproject/데이터셋/카드데이터/tbsh_gyeonggi_day_202401_용인시.csv')
df_202402_yongin=pd.read_csv('C:/portfolio/khuda_toyproject/데이터셋/카드데이터/tbsh_gyeonggi_day_202402_용인시.csv')
df_202403_yongin=pd.read_csv('C:/portfolio/khuda_toyproject/데이터셋/카드데이터/tbsh_gyeonggi_day_202403_용인시.csv')
df_202404_yongin=pd.read_csv('C:/portfolio/khuda_toyproject/데이터셋/카드데이터/tbsh_gyeonggi_day_202404_용인시.csv')
df_202405_yongin=pd.read_csv('C:/portfolio/khuda_toyproject/데이터셋/카드데이터/tbsh_gyeonggi_day_용인시_202405.csv')
df_202406_yongin=pd.read_csv('C:/portfolio/khuda_toyproject/데이터셋/카드데이터/tbsh_gyeonggi_day_용인시_202406.csv')
df_202407_yongin=pd.read_csv('C:/portfolio/khuda_toyproject/데이터셋/카드데이터/tbsh_gyeonggi_day_용인시_202407.csv')
df_202408_yongin=pd.read_csv('C:/portfolio/khuda_toyproject/데이터셋/카드데이터/tbsh_gyeonggi_day_용인시_202408.csv')
df_202409_yongin=pd.read_csv('C:/portfolio/khuda_toyproject/데이터셋/카드데이터/tbsh_gyeonggi_day_용인시_202409.csv')
df_202410_yongin=pd.read_csv('C:/portfolio/khuda_toyproject/데이터셋/카드데이터/tbsh_gyeonggi_day_용인시_202410.csv')
df_202411_yongin=pd.read_csv('C:/portfolio/khuda_toyproject/데이터셋/카드데이터/tbsh_gyeonggi_day_용인시_202411.csv')
df_202412_yongin=pd.read_csv('C:/portfolio/khuda_toyproject/데이터셋/카드데이터/tbsh_gyeonggi_day_용인시_202412.csv',encoding='cp949')

def preprocess_monthly_myeongji(df, month):
    """
    카드데이터에서 특정 admn_cty_no 필터 → 업종별 매출 합계 → 컬럼명 변경
    df : 원본 데이터프레임
    month : 문자열, 예) '202201'
    admi_no : 필터링할 admi_cty_no (기본값=41117585)
    """
    df = df[df['admi_cty_no'] == 41461525]
    df = df.groupby(['card_tpbuz_nm_1', 'card_tpbuz_nm_2'])['amt'].sum().reset_index()
    df = df.rename(columns={'amt': f'amt_{month}'})
    return df

def preprocess_monthly_dku(df, month):
    """
    카드데이터에서 특정 admn_cty_no 필터 → 업종별 매출 합계 → 컬럼명 변경
    df : 원본 데이터프레임
    month : 문자열, 예) '202201'
    admi_no : 필터링할 admi_cty_no (기본값=41117585)
    """
    df = df[df['admi_cty_no'] == 41465555]
    df = df.groupby(['card_tpbuz_nm_1', 'card_tpbuz_nm_2'])['amt'].sum().reset_index()
    df = df.rename(columns={'amt': f'amt_{month}'})
    return df

def preprocess_monthly_yu(df, month):
    """
    카드데이터에서 특정 admn_cty_no 필터 → 업종별 매출 합계 → 컬럼명 변경
    df : 원본 데이터프레임
    month : 문자열, 예) '202201'
    admi_no : 필터링할 admi_cty_no (기본값=41117585)
    """
    df = df[df['admi_cty_no'] == 41461526]
    df = df.groupby(['card_tpbuz_nm_1', 'card_tpbuz_nm_2'])['amt'].sum().reset_index()
    df = df.rename(columns={'amt': f'amt_{month}'})
    return df

df_202201_yongin.info()
df_202201_yongin['admi_cty_no'].unique()
sub = df_202201_yongin[
    (df_202201_yongin['card_tpbuz_nm_1'] == '음식') &
    (df_202201_yongin['admi_cty_no'] == 41461526)
]
sub['card_tpbuz_nm_2'].unique()

df_202201_yongin[
    (df_202201_yongin["card_tpbuz_nm_1"]=="음식") & 
    (df_202201_yongin["card_tpbuz_nm_2"]=="양식")
]["amt"].sum()

df_202201_myeongji=preprocess_monthly_myeongji(df_202201_yongin,'202201')
df_202202_myeongji=preprocess_monthly_myeongji(df_202202_yongin,'202202')
df_202203_myeongji=preprocess_monthly_myeongji(df_202203_yongin,'202203')
df_202204_myeongji=preprocess_monthly_myeongji(df_202204_yongin,'202204')
df_202205_myeongji=preprocess_monthly_myeongji(df_202205_yongin,'202205')
df_202206_myeongji=preprocess_monthly_myeongji(df_202206_yongin,'202206')
df_202207_myeongji=preprocess_monthly_myeongji(df_202207_yongin,'202207')
df_202208_myeongji=preprocess_monthly_myeongji(df_202208_yongin,'202208')
df_202209_myeongji=preprocess_monthly_myeongji(df_202209_yongin,'202209')
df_202210_myeongji=preprocess_monthly_myeongji(df_202210_yongin,'202210')
df_202211_myeongji=preprocess_monthly_myeongji(df_202211_yongin,'202211')
df_202212_myeongji=preprocess_monthly_myeongji(df_202212_yongin,'202212')

df_202301_myeongji=preprocess_monthly_myeongji(df_202301_yongin,'202301')
df_202302_myeongji=preprocess_monthly_myeongji(df_202302_yongin,'202302')
df_202303_myeongji=preprocess_monthly_myeongji(df_202303_yongin,'202303')
df_202304_myeongji=preprocess_monthly_myeongji(df_202304_yongin,'202304')
df_202305_myeongji=preprocess_monthly_myeongji(df_202305_yongin,'202305')
df_202306_myeongji=preprocess_monthly_myeongji(df_202306_yongin,'202306')
df_202307_myeongji=preprocess_monthly_myeongji(df_202307_yongin,'202307')
df_202308_myeongji=preprocess_monthly_myeongji(df_202308_yongin,'202308')
df_202309_myeongji=preprocess_monthly_myeongji(df_202309_yongin,'202309')
df_202310_myeongji=preprocess_monthly_myeongji(df_202310_yongin,'202310')
df_202311_myeongji=preprocess_monthly_myeongji(df_202311_yongin,'202311')
df_202312_myeongji=preprocess_monthly_myeongji(df_202312_yongin,'202312')

df_202401_myeongji=preprocess_monthly_myeongji(df_202401_yongin,'202401')
df_202402_myeongji=preprocess_monthly_myeongji(df_202402_yongin,'202402')
df_202403_myeongji=preprocess_monthly_myeongji(df_202403_yongin,'202403')
df_202404_myeongji=preprocess_monthly_myeongji(df_202404_yongin,'202404')
df_202405_myeongji=preprocess_monthly_myeongji(df_202405_yongin,'202405')
df_202406_myeongji=preprocess_monthly_myeongji(df_202406_yongin,'202406')
df_202407_myeongji=preprocess_monthly_myeongji(df_202407_yongin,'202407')
df_202408_myeongji=preprocess_monthly_myeongji(df_202408_yongin,'202408')
df_202409_myeongji=preprocess_monthly_myeongji(df_202409_yongin,'202409')
df_202410_myeongji=preprocess_monthly_myeongji(df_202410_yongin,'202410')
df_202411_myeongji=preprocess_monthly_myeongji(df_202411_yongin,'202411')
df_202412_myeongji=preprocess_monthly_myeongji(df_202412_yongin,'202412')

pd.set_option('display.float_format', '{:.2f}'.format)
df_merge_myeongji = (
    df_202201_myeongji
    .merge(df_202202_myeongji, on=['card_tpbuz_nm_1','card_tpbuz_nm_2'], how='outer')
    .merge(df_202203_myeongji, on=['card_tpbuz_nm_1','card_tpbuz_nm_2'], how='outer')
    .merge(df_202204_myeongji, on=['card_tpbuz_nm_1','card_tpbuz_nm_2'], how='outer')
    .merge(df_202205_myeongji, on=['card_tpbuz_nm_1','card_tpbuz_nm_2'], how='outer')
    .merge(df_202206_myeongji, on=['card_tpbuz_nm_1','card_tpbuz_nm_2'], how='outer')
    .merge(df_202207_myeongji, on=['card_tpbuz_nm_1','card_tpbuz_nm_2'], how='outer')
    .merge(df_202208_myeongji, on=['card_tpbuz_nm_1','card_tpbuz_nm_2'], how='outer')
    .merge(df_202209_myeongji, on=['card_tpbuz_nm_1','card_tpbuz_nm_2'], how='outer')
    .merge(df_202210_myeongji, on=['card_tpbuz_nm_1','card_tpbuz_nm_2'], how='outer')
    .merge(df_202211_myeongji, on=['card_tpbuz_nm_1','card_tpbuz_nm_2'], how='outer')
    .merge(df_202212_myeongji, on=['card_tpbuz_nm_1','card_tpbuz_nm_2'], how='outer')
    .merge(df_202301_myeongji, on=['card_tpbuz_nm_1','card_tpbuz_nm_2'], how='outer')
    .merge(df_202302_myeongji, on=['card_tpbuz_nm_1','card_tpbuz_nm_2'], how='outer')
    .merge(df_202303_myeongji, on=['card_tpbuz_nm_1','card_tpbuz_nm_2'], how='outer')
    .merge(df_202304_myeongji, on=['card_tpbuz_nm_1','card_tpbuz_nm_2'], how='outer')
    .merge(df_202305_myeongji, on=['card_tpbuz_nm_1','card_tpbuz_nm_2'], how='outer')
    .merge(df_202306_myeongji, on=['card_tpbuz_nm_1','card_tpbuz_nm_2'], how='outer')
    .merge(df_202307_myeongji, on=['card_tpbuz_nm_1','card_tpbuz_nm_2'], how='outer')
    .merge(df_202308_myeongji, on=['card_tpbuz_nm_1','card_tpbuz_nm_2'], how='outer')
    .merge(df_202309_myeongji, on=['card_tpbuz_nm_1','card_tpbuz_nm_2'], how='outer')
    .merge(df_202310_myeongji, on=['card_tpbuz_nm_1','card_tpbuz_nm_2'], how='outer')
    .merge(df_202311_myeongji, on=['card_tpbuz_nm_1','card_tpbuz_nm_2'], how='outer')
    .merge(df_202312_myeongji, on=['card_tpbuz_nm_1','card_tpbuz_nm_2'], how='outer')
    .merge(df_202401_myeongji, on=['card_tpbuz_nm_1','card_tpbuz_nm_2'], how='outer')
    .merge(df_202402_myeongji, on=['card_tpbuz_nm_1','card_tpbuz_nm_2'], how='outer')
    .merge(df_202403_myeongji, on=['card_tpbuz_nm_1','card_tpbuz_nm_2'], how='outer')
    .merge(df_202404_myeongji, on=['card_tpbuz_nm_1','card_tpbuz_nm_2'], how='outer')
    .merge(df_202405_myeongji, on=['card_tpbuz_nm_1','card_tpbuz_nm_2'], how='outer')
    .merge(df_202406_myeongji, on=['card_tpbuz_nm_1','card_tpbuz_nm_2'], how='outer')
    .merge(df_202407_myeongji, on=['card_tpbuz_nm_1','card_tpbuz_nm_2'], how='outer')
    .merge(df_202408_myeongji, on=['card_tpbuz_nm_1','card_tpbuz_nm_2'], how='outer')
    .merge(df_202409_myeongji, on=['card_tpbuz_nm_1','card_tpbuz_nm_2'], how='outer')
    .merge(df_202410_myeongji, on=['card_tpbuz_nm_1','card_tpbuz_nm_2'], how='outer')
    .merge(df_202411_myeongji, on=['card_tpbuz_nm_1','card_tpbuz_nm_2'], how='outer')
    .merge(df_202412_myeongji, on=['card_tpbuz_nm_1','card_tpbuz_nm_2'], how='outer')
)
df_merge_myeongji.to_csv('C:/portfolio/khuda_toyproject/데이터셋/카드데이터/merge_myeongji.csv')
df_merge_myeongji


##단국대
df_202201_dku=preprocess_monthly_dku(df_202201_yongin,'202201')
df_202202_dku=preprocess_monthly_dku(df_202202_yongin,'202202')
df_202203_dku=preprocess_monthly_dku(df_202203_yongin,'202203')
df_202204_dku=preprocess_monthly_dku(df_202204_yongin,'202204')
df_202205_dku=preprocess_monthly_dku(df_202205_yongin,'202205')
df_202206_dku=preprocess_monthly_dku(df_202206_yongin,'202206')
df_202207_dku=preprocess_monthly_dku(df_202207_yongin,'202207')
df_202208_dku=preprocess_monthly_dku(df_202208_yongin,'202208')
df_202209_dku=preprocess_monthly_dku(df_202209_yongin,'202209')
df_202210_dku=preprocess_monthly_dku(df_202210_yongin,'202210')
df_202211_dku=preprocess_monthly_dku(df_202211_yongin,'202211')
df_202212_dku=preprocess_monthly_dku(df_202212_yongin,'202212')

df_202301_dku=preprocess_monthly_dku(df_202301_yongin,'202301')
df_202302_dku=preprocess_monthly_dku(df_202302_yongin,'202302')
df_202303_dku=preprocess_monthly_dku(df_202303_yongin,'202303')
df_202304_dku=preprocess_monthly_dku(df_202304_yongin,'202304')
df_202305_dku=preprocess_monthly_dku(df_202305_yongin,'202305')
df_202306_dku=preprocess_monthly_dku(df_202306_yongin,'202306')
df_202307_dku=preprocess_monthly_dku(df_202307_yongin,'202307')
df_202308_dku=preprocess_monthly_dku(df_202308_yongin,'202308')
df_202309_dku=preprocess_monthly_dku(df_202309_yongin,'202309')
df_202310_dku=preprocess_monthly_dku(df_202310_yongin,'202310')
df_202311_dku=preprocess_monthly_dku(df_202311_yongin,'202311')
df_202312_dku=preprocess_monthly_dku(df_202312_yongin,'202312')

df_202401_dku=preprocess_monthly_dku(df_202401_yongin,'202401')
df_202402_dku=preprocess_monthly_dku(df_202402_yongin,'202402')
df_202403_dku=preprocess_monthly_dku(df_202403_yongin,'202403')
df_202404_dku=preprocess_monthly_dku(df_202404_yongin,'202404')
df_202405_dku=preprocess_monthly_dku(df_202405_yongin,'202405')
df_202406_dku=preprocess_monthly_dku(df_202406_yongin,'202406')
df_202407_dku=preprocess_monthly_dku(df_202407_yongin,'202407')
df_202408_dku=preprocess_monthly_dku(df_202408_yongin,'202408')
df_202409_dku=preprocess_monthly_dku(df_202409_yongin,'202409')
df_202410_dku=preprocess_monthly_dku(df_202410_yongin,'202410')
df_202411_dku=preprocess_monthly_dku(df_202411_yongin,'202411')
df_202412_dku=preprocess_monthly_dku(df_202412_yongin,'202412')

pd.set_option('display.float_format', '{:.2f}'.format)
df_merge_dku = (
    df_202201_dku
    .merge(df_202202_dku, on=['card_tpbuz_nm_1','card_tpbuz_nm_2'], how='outer')
    .merge(df_202203_dku, on=['card_tpbuz_nm_1','card_tpbuz_nm_2'], how='outer')
    .merge(df_202204_dku, on=['card_tpbuz_nm_1','card_tpbuz_nm_2'], how='outer')
    .merge(df_202205_dku, on=['card_tpbuz_nm_1','card_tpbuz_nm_2'], how='outer')
    .merge(df_202206_dku, on=['card_tpbuz_nm_1','card_tpbuz_nm_2'], how='outer')
    .merge(df_202207_dku, on=['card_tpbuz_nm_1','card_tpbuz_nm_2'], how='outer')
    .merge(df_202208_dku, on=['card_tpbuz_nm_1','card_tpbuz_nm_2'], how='outer')
    .merge(df_202209_dku, on=['card_tpbuz_nm_1','card_tpbuz_nm_2'], how='outer')
    .merge(df_202210_dku, on=['card_tpbuz_nm_1','card_tpbuz_nm_2'], how='outer')
    .merge(df_202211_dku, on=['card_tpbuz_nm_1','card_tpbuz_nm_2'], how='outer')
    .merge(df_202212_dku, on=['card_tpbuz_nm_1','card_tpbuz_nm_2'], how='outer')
    .merge(df_202301_dku, on=['card_tpbuz_nm_1','card_tpbuz_nm_2'], how='outer')
    .merge(df_202302_dku, on=['card_tpbuz_nm_1','card_tpbuz_nm_2'], how='outer')
    .merge(df_202303_dku, on=['card_tpbuz_nm_1','card_tpbuz_nm_2'], how='outer')
    .merge(df_202304_dku, on=['card_tpbuz_nm_1','card_tpbuz_nm_2'], how='outer')
    .merge(df_202305_dku, on=['card_tpbuz_nm_1','card_tpbuz_nm_2'], how='outer')
    .merge(df_202306_dku, on=['card_tpbuz_nm_1','card_tpbuz_nm_2'], how='outer')
    .merge(df_202307_dku, on=['card_tpbuz_nm_1','card_tpbuz_nm_2'], how='outer')
    .merge(df_202308_dku, on=['card_tpbuz_nm_1','card_tpbuz_nm_2'], how='outer')
    .merge(df_202309_dku, on=['card_tpbuz_nm_1','card_tpbuz_nm_2'], how='outer')
    .merge(df_202310_dku, on=['card_tpbuz_nm_1','card_tpbuz_nm_2'], how='outer')
    .merge(df_202311_dku, on=['card_tpbuz_nm_1','card_tpbuz_nm_2'], how='outer')
    .merge(df_202312_dku, on=['card_tpbuz_nm_1','card_tpbuz_nm_2'], how='outer')
    .merge(df_202401_dku, on=['card_tpbuz_nm_1','card_tpbuz_nm_2'], how='outer')
    .merge(df_202402_dku, on=['card_tpbuz_nm_1','card_tpbuz_nm_2'], how='outer')
    .merge(df_202403_dku, on=['card_tpbuz_nm_1','card_tpbuz_nm_2'], how='outer')
    .merge(df_202404_dku, on=['card_tpbuz_nm_1','card_tpbuz_nm_2'], how='outer')
    .merge(df_202405_dku, on=['card_tpbuz_nm_1','card_tpbuz_nm_2'], how='outer')
    .merge(df_202406_dku, on=['card_tpbuz_nm_1','card_tpbuz_nm_2'], how='outer')
    .merge(df_202407_dku, on=['card_tpbuz_nm_1','card_tpbuz_nm_2'], how='outer')
    .merge(df_202408_dku, on=['card_tpbuz_nm_1','card_tpbuz_nm_2'], how='outer')
    .merge(df_202409_dku, on=['card_tpbuz_nm_1','card_tpbuz_nm_2'], how='outer')
    .merge(df_202410_dku, on=['card_tpbuz_nm_1','card_tpbuz_nm_2'], how='outer')
    .merge(df_202411_dku, on=['card_tpbuz_nm_1','card_tpbuz_nm_2'], how='outer')
    .merge(df_202412_dku, on=['card_tpbuz_nm_1','card_tpbuz_nm_2'], how='outer')
)
df_merge_dku.to_csv('C:/portfolio/khuda_toyproject/데이터셋/카드데이터/merge_dku.csv')
df_merge_dku

##용인대
df_202201_yu=preprocess_monthly_yu(df_202201_yongin,'202201')
df_202202_yu=preprocess_monthly_yu(df_202202_yongin,'202202')
df_202203_yu=preprocess_monthly_yu(df_202203_yongin,'202203')
df_202204_yu=preprocess_monthly_yu(df_202204_yongin,'202204')
df_202205_yu=preprocess_monthly_yu(df_202205_yongin,'202205')
df_202206_yu=preprocess_monthly_yu(df_202206_yongin,'202206')
df_202207_yu=preprocess_monthly_yu(df_202207_yongin,'202207')
df_202208_yu=preprocess_monthly_yu(df_202208_yongin,'202208')
df_202209_yu=preprocess_monthly_yu(df_202209_yongin,'202209')
df_202210_yu=preprocess_monthly_yu(df_202210_yongin,'202210')
df_202211_yu=preprocess_monthly_yu(df_202211_yongin,'202211')
df_202212_yu=preprocess_monthly_yu(df_202212_yongin,'202212')

df_202301_yu=preprocess_monthly_yu(df_202301_yongin,'202301')
df_202302_yu=preprocess_monthly_yu(df_202302_yongin,'202302')
df_202303_yu=preprocess_monthly_yu(df_202303_yongin,'202303')
df_202304_yu=preprocess_monthly_yu(df_202304_yongin,'202304')
df_202305_yu=preprocess_monthly_yu(df_202305_yongin,'202305')
df_202306_yu=preprocess_monthly_yu(df_202306_yongin,'202306')
df_202307_yu=preprocess_monthly_yu(df_202307_yongin,'202307')
df_202308_yu=preprocess_monthly_yu(df_202308_yongin,'202308')
df_202309_yu=preprocess_monthly_yu(df_202309_yongin,'202309')
df_202310_yu=preprocess_monthly_yu(df_202310_yongin,'202310')
df_202311_yu=preprocess_monthly_yu(df_202311_yongin,'202311')
df_202312_yu=preprocess_monthly_yu(df_202312_yongin,'202312')

df_202401_yu=preprocess_monthly_yu(df_202401_yongin,'202401')
df_202402_yu=preprocess_monthly_yu(df_202402_yongin,'202402')
df_202403_yu=preprocess_monthly_yu(df_202403_yongin,'202403')
df_202404_yu=preprocess_monthly_yu(df_202404_yongin,'202404')
df_202405_yu=preprocess_monthly_yu(df_202405_yongin,'202405')
df_202406_yu=preprocess_monthly_yu(df_202406_yongin,'202406')
df_202407_yu=preprocess_monthly_yu(df_202407_yongin,'202407')
df_202408_yu=preprocess_monthly_yu(df_202408_yongin,'202408')
df_202409_yu=preprocess_monthly_yu(df_202409_yongin,'202409')
df_202410_yu=preprocess_monthly_yu(df_202410_yongin,'202410')
df_202411_yu=preprocess_monthly_yu(df_202411_yongin,'202411')
df_202412_yu=preprocess_monthly_yu(df_202412_yongin,'202412')

pd.set_option('display.float_format', '{:.2f}'.format)
df_merge_yu = (
    df_202201_yu
    .merge(df_202202_yu, on=['card_tpbuz_nm_1','card_tpbuz_nm_2'], how='outer')
    .merge(df_202203_yu, on=['card_tpbuz_nm_1','card_tpbuz_nm_2'], how='outer')
    .merge(df_202204_yu, on=['card_tpbuz_nm_1','card_tpbuz_nm_2'], how='outer')
    .merge(df_202205_yu, on=['card_tpbuz_nm_1','card_tpbuz_nm_2'], how='outer')
    .merge(df_202206_yu, on=['card_tpbuz_nm_1','card_tpbuz_nm_2'], how='outer')
    .merge(df_202207_yu, on=['card_tpbuz_nm_1','card_tpbuz_nm_2'], how='outer')
    .merge(df_202208_yu, on=['card_tpbuz_nm_1','card_tpbuz_nm_2'], how='outer')
    .merge(df_202209_yu, on=['card_tpbuz_nm_1','card_tpbuz_nm_2'], how='outer')
    .merge(df_202210_yu, on=['card_tpbuz_nm_1','card_tpbuz_nm_2'], how='outer')
    .merge(df_202211_yu, on=['card_tpbuz_nm_1','card_tpbuz_nm_2'], how='outer')
    .merge(df_202212_yu, on=['card_tpbuz_nm_1','card_tpbuz_nm_2'], how='outer')
    .merge(df_202301_yu, on=['card_tpbuz_nm_1','card_tpbuz_nm_2'], how='outer')
    .merge(df_202302_yu, on=['card_tpbuz_nm_1','card_tpbuz_nm_2'], how='outer')
    .merge(df_202303_yu, on=['card_tpbuz_nm_1','card_tpbuz_nm_2'], how='outer')
    .merge(df_202304_yu, on=['card_tpbuz_nm_1','card_tpbuz_nm_2'], how='outer')
    .merge(df_202305_yu, on=['card_tpbuz_nm_1','card_tpbuz_nm_2'], how='outer')
    .merge(df_202306_yu, on=['card_tpbuz_nm_1','card_tpbuz_nm_2'], how='outer')
    .merge(df_202307_yu, on=['card_tpbuz_nm_1','card_tpbuz_nm_2'], how='outer')
    .merge(df_202308_yu, on=['card_tpbuz_nm_1','card_tpbuz_nm_2'], how='outer')
    .merge(df_202309_yu, on=['card_tpbuz_nm_1','card_tpbuz_nm_2'], how='outer')
    .merge(df_202310_yu, on=['card_tpbuz_nm_1','card_tpbuz_nm_2'], how='outer')
    .merge(df_202311_yu, on=['card_tpbuz_nm_1','card_tpbuz_nm_2'], how='outer')
    .merge(df_202312_yu, on=['card_tpbuz_nm_1','card_tpbuz_nm_2'], how='outer')
    .merge(df_202401_yu, on=['card_tpbuz_nm_1','card_tpbuz_nm_2'], how='outer')
    .merge(df_202402_yu, on=['card_tpbuz_nm_1','card_tpbuz_nm_2'], how='outer')
    .merge(df_202403_yu, on=['card_tpbuz_nm_1','card_tpbuz_nm_2'], how='outer')
    .merge(df_202404_yu, on=['card_tpbuz_nm_1','card_tpbuz_nm_2'], how='outer')
    .merge(df_202405_yu, on=['card_tpbuz_nm_1','card_tpbuz_nm_2'], how='outer')
    .merge(df_202406_yu, on=['card_tpbuz_nm_1','card_tpbuz_nm_2'], how='outer')
    .merge(df_202407_yu, on=['card_tpbuz_nm_1','card_tpbuz_nm_2'], how='outer')
    .merge(df_202408_yu, on=['card_tpbuz_nm_1','card_tpbuz_nm_2'], how='outer')
    .merge(df_202409_yu, on=['card_tpbuz_nm_1','card_tpbuz_nm_2'], how='outer')
    .merge(df_202410_yu, on=['card_tpbuz_nm_1','card_tpbuz_nm_2'], how='outer')
    .merge(df_202411_yu, on=['card_tpbuz_nm_1','card_tpbuz_nm_2'], how='outer')
    .merge(df_202412_yu, on=['card_tpbuz_nm_1','card_tpbuz_nm_2'], how='outer')
    
)
df_merge_yu.to_csv('C:/portfolio/khuda_toyproject/데이터셋/카드데이터/merge_yu.csv')
df_merge_yu

import pandas as pd
import matplotlib.pyplot as plt
import matplotlib

# CSV나 DF 읽어온 상태라고 가정
# df = pd.read_csv("너의파일.csv")

df=pd.read_csv('C:/portfolio/khuda_toyproject/데이터셋/카드데이터/card_income_22_24.csv',encoding='cp949')
# wide → long 변환
df_long = df.melt(
    id_vars=["school", "card_tpbuz_nm_1", "card_tpbuz_nm_2"],
    var_name="month", value_name="amount"
)

# month에서 'amt_' 떼고 문자열 → 날짜형 변환
df_long["month"] = df_long["month"].str.replace("amt_", "")
df_long["month"] = pd.to_datetime(df_long["month"], format="%Y%m")

# 시각화
matplotlib.rc('font', family='Malgun Gothic')
plt.figure(figsize=(14,6))
for name, group in df_long.groupby("card_tpbuz_nm_1"):
    plt.plot(group["month"], group["amount"], marker="o", label=name)

plt.xlabel("월")
plt.ylabel("매출액")
plt.title("업종별 월별 매출 추세")
plt.legend()
plt.grid(True, alpha=0.3)
plt.tight_layout()
plt.show()

df['school']

import pandas as pd
import numpy as np
import matplotlib.pyplot as plt

# df: 너 CSV 읽어온 그 테이블
# df = pd.read_csv("card_income_22_24.csv")  # 너 파일 경로

# ---------- 1) wide → long ----------
df_long = df.melt(
    id_vars=["school", "card_tpbuz_nm_1", "card_tpbuz_nm_2"],
    var_name="month", value_name="amount"
)

# 'amt_YYYYMM' → datetime
df_long["month"] = pd.to_datetime(df_long["month"].str.replace("amt_", ""), format="%Y%m", errors="coerce")
df_long = df_long.dropna(subset=["month"])

# ---------- 2) 필터: 4개 대학 + 음식 ----------
targets = ["경희대", "명지대", "단국대", "용인대"]
f = (
    df_long["school"].isin(targets)
    & (df_long["card_tpbuz_nm_1"] == "음식")
)
d = df_long.loc[f, ["school", "month", "amount"]].copy()
d["amount"] = d["amount"].fillna(0)

# 소분류(한식/중식/유흥주점 등) 여러 개면 대학별로 합쳐서 비교
d_sum = d.groupby(["school", "month"])["amount"].sum().reset_index()

# ---------- 3) 라인 그래프(대학별 비교) ----------
plt.figure(figsize=(14,6))
for name, g in d_sum.groupby("school"):
    g = g.sort_values("month")
    # 3개월 이동평균으로 덜 요동치게 (원하면 주석 처리)
    y = g["amount"].rolling(3, min_periods=1).mean()
    plt.plot(g["month"], y, marker="o", linewidth=1, label=name)

plt.title("4개 대학 ‘음식’ 대분류 월별 매출(합계)")
plt.xlabel("월"); plt.ylabel("매출액")
plt.grid(True, alpha=0.3)
plt.legend()
plt.tight_layout()
plt.show()


import pandas as pd
import matplotlib.pyplot as plt

# df = pd.read_csv("card_income_22_24.csv")  # 너의 CSV

# ---------- 1) wide → long ----------
df_long = df.melt(
    id_vars=["school", "card_tpbuz_nm_1", "card_tpbuz_nm_2"],
    var_name="month", value_name="amount"
)

# 'amt_YYYYMM' → datetime
df_long["month"] = pd.to_datetime(
    df_long["month"].str.replace("amt_", ""), format="%Y%m", errors="coerce"
)
df_long = df_long.dropna(subset=["month"])

# ---------- 2) 경희대 + 대분류 ----------
df_khu = df_long[df_long["school"] == "용인대"]

# 대분류 합계
df_khu_sum = df_khu.groupby(["card_tpbuz_nm_1", "month"])["amount"].sum().reset_index()

# ---------- 3) 시각화 ----------
plt.figure(figsize=(14,6))
for cat, g in df_khu_sum.groupby("card_tpbuz_nm_1"):
    g = g.sort_values("month")
    plt.plot(g["month"], g["amount"], marker="o", linewidth=1, label=cat)

plt.title("용인대 대분류별 월별 매출 추세")
plt.xlabel("월"); plt.ylabel("매출액")
plt.legend(ncol=2, fontsize=9)
plt.grid(True, alpha=0.3)
plt.tight_layout()
plt.show()



import pandas as pd
import seaborn as sns
import matplotlib.pyplot as plt

# ---------- 1) wide → long ----------
df_long = df.melt(
    id_vars=["school", "card_tpbuz_nm_1", "card_tpbuz_nm_2"],
    var_name="month", value_name="amount"
)
df_long["month"] = pd.to_datetime(
    df_long["month"].str.replace("amt_", ""), format="%Y%m", errors="coerce"
)
df_long = df_long.dropna(subset=["month"])
df_long["amount"] = df_long["amount"].fillna(0)

# ---------- 2) 소매/유통만 필터 ----------
df_retail = df_long[df_long["card_tpbuz_nm_1"] == "소매/유통"]

# ---------- 3) FacetGrid: 학교별 subplot ----------
g = sns.FacetGrid(
    df_retail,
    col="school", col_wrap=2, height=4, sharex=True, sharey=False
)
g.map_dataframe(sns.lineplot, x="month", y="amount", hue="card_tpbuz_nm_2", marker="o")

g.add_legend()
g.set_axis_labels("월", "매출액")
g.set_titles("{col_name}")

plt.tight_layout()
plt.show()

df_card_income=pd.read_csv('C:/portfolio/khuda_toyproject/데이터셋/카드데이터/card_income_22_24.csv',encoding='cp949')
df_card_income.info()

import pandas as pd

# df: 원본 데이터프레임 (amt_202201 ~ amt_202412)

# 1) wide → long
df_long = df_card_income.melt(
    id_vars=[c for c in df_card_income.columns if not c.startswith("amt_")],  # school, 업종 같은 식별자 유지
    var_name="month", value_name="amount"
)

# 2) YYYYMM → datetime 변환
df_long["month"] = df_long["month"].str.replace("amt_", "")
df_long["month"] = pd.to_datetime(df_long["month"], format="%Y%m", errors="coerce")

# 3) 분기 구하기
df_long["quarter"] = df_long["month"].dt.to_period("Q")  # 예: 2022Q1, 2022Q2 …

# 4) 그룹핑 (식별자 + 분기)
id_vars = [c for c in df_card_income.columns if not c.startswith("amt_")]
df_quarter = df_long.groupby(id_vars + ["quarter"])["amount"].sum().reset_index()

# 5) 다시 wide로 pivot (분기별 컬럼화 원하면)
df_quarter_wide = df_quarter.pivot(
    index=id_vars, columns="quarter", values="amount"
).reset_index()

print(df_quarter_wide.head())
df_quarter_wide.to_csv('C:/portfolio/khuda_toyproject/데이터셋/카드데이터/card_income_quarter.csv')